@startuml Package Diagram - CP3 Simplified View

!theme plain
skinparam packageStyle rectangle
skinparam dpi 120
skinparam packageBackgroundColor #F4ECFE
skinparam packageBorderColor #6C3FA7
skinparam noteBackgroundColor #FFF3CD
skinparam noteBorderColor #856404

left to right direction

package "Core Platform" {
    [src/config.py] as Config
    [src/main.py] as Main
    [src/models.py] as Models
    [src/database.py] as Database
}

package "Experience Layer" {
    [src/blueprints/returns.py] as ReturnsBP
    [templates/] as Templates
}

package "Domain Services" {
    [src/services/returns_service.py] as ReturnsSvc
    [src/services/refund_service.py] as RefundSvc
    [src/services/payment_service.py] as PaymentSvc
    [src/services/inventory_service.py] as InventorySvc
}

package "Reliability & Observability" {
    [src/tactics/manager.py] as TacticsManager
    [src/tactics/availability.py] as Availability
    [src/tactics/performance.py] as Performance
    [src/observability/metrics.py] as Metrics
    [src/observability/business_metrics.py] as BusinessMetrics
}

package "Deployment & Tooling" as Deploy {
    [Dockerfile]
    [deploy/dockercompose.yml]
    [docker/entrypoint.sh]
    [scripts/bootstrap_super_admin.py]
}

package "Tests" as TestsPkg {
    [tests/test_returns_service.py]
    [tests/test_returns_api.py]
    [tests/test_business_metrics.py]
    [tests/test_quality_scenario_validation.py]
}

package "Docs" as DocsPkg {
    [docs/ADR/ADR_CP3.md]
    [docs/UML/*.puml]
    [Checkpoint3.md]
    [docs/Runbook.md]
}

Main --> ReturnsBP
ReturnsBP --> ReturnsSvc
ReturnsBP --> Templates

ReturnsSvc --> RefundSvc
ReturnsSvc --> InventorySvc
RefundSvc --> PaymentSvc
ReturnsSvc --> Models
InventorySvc --> Models

TacticsManager --> Availability
TacticsManager --> Performance
Main --> TacticsManager
TacticsManager --> Metrics
BusinessMetrics --> Metrics
BusinessMetrics --> Models

Deploy --> Main : containerizes
Deploy --> Database : seeds

TestsPkg --> ReturnsSvc
TestsPkg --> ReturnsBP
TestsPkg --> BusinessMetrics
TestsPkg --> TacticsManager

DocsPkg --> Deploy : instructions
DocsPkg --> BusinessMetrics : diagrams & runbook

note right of ReturnsSvc
  RMA workflow engine
  - Validates requests
  - Drives shipment, inspection, refund states
end note

note right of BusinessMetrics
  Dashboard KPIs
  - Quarter windows
  - RMA rate & cycle time
  - Uses Config.DEFAULT_TIMEZONE
end note

@enduml
